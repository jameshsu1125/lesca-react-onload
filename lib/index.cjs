"use strict";const f=require("react");var p=(l=>(l[l.unload=0]="unload",l[l.loading=1]="loading",l[l.loaded=2]="loaded",l))(p||{});const x={hideBeforeLoaded:!0,onUpdate:l=>{}};class v{index;result;constructor(){this.index=0,this.result=[]}load(t,s=x){if(!t)return new Promise(r=>{r({total:0,loaded:0})});const d={...x,...s},{onUpdate:n,hideBeforeLoaded:e}=d,h=this.getStyle(t,"display")==="flex"?"flex":"block";e&&(t.style.display="none");var w=Array.from(t.querySelectorAll("*"));[t,...w].forEach((r,a)=>{const o=r.tagName,i=r.getAttribute("src"),u=this.getStyle(r,"background-image").replace(/url\((['"])?(.*?)\1\)/gi,"$2"),g=this.getStyle(r,"-webkit-mask-image").replace(/url\((['"])?(.*?)\1\)/gi,"$2"),c=p.unload;return o==="IMG"&&i?(this.result.push({url:i,index:a,status:c}),!0):o==="DIV"&&u!=="none"?(u.includes("gradient")||this.result.push({url:u,index:a,status:c}),!0):(o==="DIV"&&g!=="none"&&this.result.push({url:g,index:a,status:c}),!1)});const m=({resolve:r=o=>console.log(o),reject:a=o=>console.log(o)})=>{if(this.result.length===0){e&&(t.style.display=h),r({total:0,loaded:0});return}const o=this.result[this.index],i=this.result.length,{url:u,index:g}=o;o.status=p.loading;const c=new Image;c.onload=()=>{o.status=p.loaded;const y=this.result.filter(S=>S.status===p.loaded).length;i===y?(e&&(t.style.display=h),requestAnimationFrame(()=>r({url:u,total:i,loaded:y,index:g}))):(n({url:u,total:i,loaded:y,index:g}),this.index++,m({resolve:r,reject:a}))},c.src=u};return new Promise((r,a)=>{m({resolve:r,reject:a})})}getStyle(t,s){let d;const n=t.ownerDocument.defaultView;return n&&n.getComputedStyle?(s=s.replace(/([A-Z])/g,"-$1").toLowerCase(),n.getComputedStyle(t,null).getPropertyValue(s)):t.currentStyle?(s=s.replace(/\-(\w)/g,function(e,h){return h.toUpperCase()}),d=t.currentStyle[s],d):""}}const b=({children:l,hideBeforeLoaded:t=!0,onStep:s,onload:d})=>{const n=f.useRef(void 0);return f.useEffect(()=>{n&&n.current&&new v().load(n.current,{hideBeforeLoaded:t,onUpdate:e=>s?.(e)}).then(e=>d?.(e))},[]),f.Children.map(l,e=>e&&typeof e=="object"&&"props"in e?f.cloneElement(e,{...e.props,ref:n}):e)};module.exports=b;
